<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <% if @prefs.refresh != 0 -%>
    <meta http-equiv="Refresh" content="<%= @prefs["refresh"].to_i*60 %>;url=<%= request.request_uri %>">
  <% end -%>
  <%= stylesheet_link_tag "standard" %>
  <%= stylesheet_link_tag "print", :media => "print" %>
  <%= javascript_include_tag :defaults %>
  <%= javascript_include_tag "selector-addon-v1" %>
  <%= stylesheet_link_tag 'calendar-system.css' %>
  <%= javascript_include_tag 'calendar', 'calendar-en', 'calendar-setup' %>
  <%= javascript_include_tag "accesskey-hints" %>
  <%= javascript_include_tag "todo-items" %>
  
  <link rel="shortcut icon" href="<%= url_for(:controller => 'favicon.ico') %>" />
  <%= auto_discovery_link_tag(:rss,{:controller => "feed", :action => "na_feed", :name => "#{@user.login}", :token => "#{@user.word}"}, {:title => "RSS feed of next actions"})  %>

<title><%= @page_title %></title>

</head>
<body>
<div id="topbar">
<div id="date">
  <h1>
  <% if @count %>
    <span id="badge_count" class="badge"><%= @count %></span>
  <% end %>
  <%= Time.now.strftime("%A, %d %B %Y") %> <%= image_tag("spinner.gif", :size => "16X16", :border => 0, :id => 'busy', :style => 'display:none' ) %>
  </h1>
</div>
<div id="minilinks">
	<%= link_to_function("Toggle notes", nil, {:accesskey => "S", :title => "Toggle all notes"}) do |page|
		  page.select('.notes').each { |e| e.toggle }
		end
	-%>&nbsp;|&nbsp;
    <%= link_to "Logout (#{@user.display_name}) Â»", :controller => "login", :action=>"logout"%>
</div>

<div id="navcontainer">
<ul id="navlist">
  <li><%= navigation_link("Home", {:controller => "todo", :action => "index"}, {:accesskey => "t", :title => "Home"} ) %></li>
  <li><%= navigation_link( "Contexts", {:controller => "context", :action => "list"}, {:accesskey=>"c", :title=>"Contexts"} ) %></li>
  <li><%= navigation_link( "Projects", {:controller => "project", :action => "list"}, {:accesskey=>"p", :title=>"Projects"} ) %></li>
  <li><%= navigation_link( "Tickler", {:controller => "todo", :action => "tickler"}, :title => "Tickler" ) %></li>
  <li><%= navigation_link( "Done", {:controller => "todo", :action => "completed"}, {:accesskey=>"d", :title=>"Completed"} ) %></li>
  <li><%= navigation_link( "Notes", {:controller => "note", :action => "index"}, {:accesskey => "o", :title => "Show all notes"} ) %></li>
  <li><%= navigation_link( "Preferences", {:controller => "user", :action => "preferences"}, {:accesskey => "u", :title => "Show my preferences"} ) %></li>
  <% if @user.is_admin? -%>
    <li><%= navigation_link("Admin", {:controller => "admin", :action => "index"}, {:accesskey => "a", :title => "Add or delete users"} ) %></li>
  <% end -%>
  <li><%= navigation_link(image_tag("feed-icon.png", :size => "16X16", :border => 0), {:controller => "feed", :action => "index"}, :title => "See a list of available feeds" ) %></li>
</ul>
</div>

<%= render_flash %>
</div>

<div id="content">

<% unless @controller_name == 'feed' or session['noexpiry'] == "on" -%>
<%= periodically_call_remote( :url => {:controller => "login", :action => "check_expiry"},
                              :frequency => (5*60)) %>
<% end -%>
<%= periodically_call_remote( :url => {:controller => "todo", :action => "check_tickler"},
                              :frequency => (10*60)) %>  
<%= yield %>
</div>

<div id="footer">
  <p>Send feedback: <a href="http://dev.rousette.org.uk/report/6">Trac</a> | <a href="http://www.rousette.org.uk/projects/forums/">Forum</a> | <a href="http://www.rousette.org.uk/projects/wiki/index">Wiki</a> | <a href="mailto:butshesagirl@rousette.org.uk?subject=Tracks feedback">Email</a> | <a href="http://www.rousette.org.uk/projects/">Website</a></p>
</div>
</body>
</html>
